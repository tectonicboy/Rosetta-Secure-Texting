#define _GNU_SOURCE

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <stdint.h>
#include <math.h>

#include <time.h>

#include "../bigint.h"

int main(){
   
    clock_t t;
    double time;
    struct bigint big1, big_prime;
    uint8_t RM_res;
    
    /* 3000 bits */
    char* bit_number = 
    "100111111101101010000011110100001100011011001111111010100110110110110010010100101100011100110100100011001011101000110010100110101100110111101110001111"
    "100011100011100010000000100100110110000000100011110111010010100101111111010101101100100101101000010000111110100110111101000111001000001110110100010110"
    "001100001010111010010001010110111001001001001001001101001001000011100010011000101111010010000001010011110001100011100010101111001010101111111100100110"
    "000110100011010110101000001011010000101100011000001001000011100010110010010001100111110111010010100000000010000000101100010100111110110010110001100010"
    "100110100101100010101110111001001110000000100011010110000000000110110000111000101011101000111001100000011010000101100100100110011101100010001001011010"
    "011000000010111010110100110111111111110000110100100001111010111100000111110000001000010111000011000111111110110110111100010111110000010000100010100000"
    "010011110110101110011010110110011011110111111111000001110000111101111001111001000010000111100011011011101001100001110000110101111110010010100111001010"
    "001011101011010011111110110010111100101110010110101011001100111100110100001011000010001010010001001110001101110000111111001000000011011001111111101101"
    "010101000000001110000001011100010101000110111100000010100001111111101000101110000010011100000000001001101101100001011000001010001100001101000110011010"
    "110011101010100001101101001110000111101011111011110011101101101010110100100100110110101001001100010110110101001000000001000001101011010111110001100101"
    "000100101101011010000010110010000111000111010011000111010101000100100001011100001100011000111100010101110000001111111011001010001001101101101110100000"
    "100100011000010011110011001000010011111111011111111111011001101010001100001110101001001001110101110101110011111000111001010000000100000111001101010001"
    "100100101101100011010110110100010011100010000100001011000100011111000011111101100001110001110001010110011101111010001100101100010011000011111110110011"
    "011110111001110101110100110100010110010011011100001001100010101011100001001010000001000010110101010001101111111101010010000110100110110100000111111101"
    "001100101010101111110111000111010000111101100101101000101011111000110001110011100110010000110101010001101100111001010111001111100001111010111001110011"
    "110110001011101010100101000010111101000000110100001110011001111111000011111011000101011110001100110010100100001000000101100101111001111001111111001010"
    "001001011010000100110110011101001101110010010100011111001111000010111011000111000100011011110001010100011101110001001101010110010000010110110011101110"
    "011100010001011110111010111101100101000110000010000010111111100000001100101101100010000011011001000110111000110011111101011001110010101001011101001100"
    "101000100100101010100110111011000011110011101101000100011001110100000001010011011001101001110010001000100011010100111101011100101101001011110010110000"
    "111000111101011110100100111010101100101001011110010100100011110101010100111010111000110110111111011000100010010101011101001000110101100101001110000011\0"
    ;

    /* 3000 bits */
    char* prime_string_bigend = 
   "10000011010100111101011001001000010101111000100111011000011011111110001100111010010101011000111"
   "11001010010010111101100100011101011101001111101010011100000101100001011110010110111010111010100"
   "11001000110010001010100111110110010001010011010000000110011101000111001110110000110110111010101"
   "01000100100110010100111010010101001100111001111010100110011011011100110010010000011110110000011"
   "00101110000000101111000010000100011011011001111010110101111011000100101110011011001100000101010"
   "11001010011011101110001010001111100010100011000011100101110111111000001111100100101001101110001"
   "11010000110110101000010010010111001010100111111110011101100101100000011001000000110010111000110"
   "00101011111101111110000011001110000111000001101111101000100001010101001001011101111011010011100"
   "11101011111000010111001111100101011011000101010001000011111001100001110011100011001010110101101"
   "01111011011010000011100011011111100101010110100110001111110110100011010010100100011111101000110"
   "11110101010100001010100000100001001010101110011000011100001001001101000101110100110111010111101"
   "11011001101111111100011000010110001100011001101111001011001011100010001110011110110110000110100"
   "01110010110010000100001110001101000111010110110110001001001001010001011100110001000001010000100"
   "01110110011110111010110011101101001000000111010100011011001101111111111110111010011111100100000"
   "11110001100001001001001110100010110110100010011011001000111111011100001100010101100011000011000"
   "00101110001001011010101001100010001110110000111001011000110100000101101010100011100011011010111"
   "00011010000001000100100001101101001100011010100101001101110100100110101000111011111011111110101"
   "11110000110110100101000010011101001101011010001101100001100101000010110001101100000100110000000"
   "00001001111011100011101000000111110000101010111100010100010111000110000001000000110101010011101"
   "10110011111000011011100100000001111001101110100111010100100000010000000101111001101001100111010"
   "10111110010111110010101100100011111110101101100010110111001001001010011111100000110110000111111"
   "01001001101100001111001000010100111101111011101110000111100001101111110011011101011011011100111"
   "11011000000100100010100001000001111100111100011011011001111111000011000001011100000010000111111"
   "01111000001111011010010111100000111111111010011101110101000000001101001100010011101100010011001"
   "01100100101000011000000100111001101110101110001010110000000000010101100000100011111000001110010"
   "01010111001011000100110100110001000101100111110110001010000001011000010001010000001110100100111"
   "11100100010010110000001110000010011100011001000010000010110110101010001101100001101100100110111"
   "11111001010001010111000111011110001000101000100100000101111001001100000111001001001100100110010"
   "01001011100100010101111010010000101001100011110100010000111001110010111101001010011000001111101"
   "00001001001010101101111111101101001010111010010001111100000000100110100000010111000100011100000"
   "11111011101110110011011001101000110010101110101000110000110100110001110101001010110010011011011"
   "1101010110011111100011011010000100000111110001011001111\0"
    ;
    
    char prime_string_little[3001];
    prime_string_little[3000] = 0;
    
    bitstring_big_to_little_end(prime_string_bigend, (3000 / 8), prime_string_little);
    
    uint32_t len = strlen(bit_number);
    printf("Len of bit_number = %u\n", len);      
                    
    bigint_create_from_string(&big1, 7008, bit_number, len);
    
    bigint_create_from_string(&big_prime, 7008, prime_string_little, len);
    
       

    struct bigint N1; /* 78007 */
    uint32_t init = 428403353, passes = 2;
    bigint_create(&N1, 7008, init);
 
    printf("Rabin-Miller will test this 3000-bit number (little-endian format):\n");
    
    bigint_print_bits_bigend(&big_prime);

    t = clock();
    
    RM_res = Rabin_Miller(&big_prime, passes);  
      
    t = clock() - t;
    
    time = ((double)t)/CLOCKS_PER_SEC; //in seconds  

 

    output_red(); 
    printf("\n[END] ---> "); 
    if(RM_res){ printf("PRIME\n\n"); }
    else{ printf("COMPOSITE\n\n"); }
    output_rst();
    printf("Time taken to check with %u passes: %f seconds\n", passes, time);
      
           
    return 0;
        
}           
