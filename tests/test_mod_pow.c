#include "../bigint.h"
#include <time.h>

#define MAX_BITLEN 8000

int main(){
    struct bigint 
      N1 
     ,N2 
     ,N3
     ,N4
     ,mod
     ,mod2
     ,R   
     ,R2         
     ;           
  
    bigint_create(&N1,   MAX_BITLEN, 178473 );
    bigint_create(&N2,   MAX_BITLEN, 2 );

    bigint_create(&mod,  MAX_BITLEN, 799777 );  
    
    bigint_create(&R,    MAX_BITLEN, 0   );

    bigint_mod_pow(&N1, &N2, &mod, &R);
    
    output_yel(); printf("\n^^^ Expected: 210343  ^^^\n\n"); output_rst();
    
    bigint_print_info(&R);
    bigint_print_bits(&R);
    
       /* 3000 bits */
    char* bit_number = 
    "100111111101101010000011110100001100011011001111111010100110110110110010010100101100011100110100100011001011101000110010100110101100110111101110001111"
    "100011100011100010000000100100110110000000100011110111010010100101111111010101101100100101101000010000111110100110111101000111001000001110110100010110"
    "001100001010111010010001010110111001001001001001001101001001000011100010011000101111010010000001010011110001100011100010101111001010101111111100100110"
    "000110100011010110101000001011010000101100011000001001000011100010110010010001100111110111010010100000000010000000101100010100111110110010110001100010"
    "100110100101100010101110111001001110000000100011010110000000000110110000111000101011101000111001100000011010000101100100100110011101100010001001011010"
    "011000000010111010110100110111111111110000110100100001111010111100000111110000001000010111000011000111111110110110111100010111110000010000100010100000"
    "010011110110101110011010110110011011110111111111000001110000111101111001111001000010000111100011011011101001100001110000110101111110010010100111001010"
    "001011101011010011111110110010111100101110010110101011001100111100110100001011000010001010010001001110001101110000111111001000000011011001111111101101"
    "010101000000001110000001011100010101000110111100000010100001111111101000101110000010011100000000001001101101100001011000001010001100001101000110011010"
    "110011101010100001101101001110000111101011111011110011101101101010110100100100110110101001001100010110110101001000000001000001101011010111110001100101"
    "000100101101011010000010110010000111000111010011000111010101000100100001011100001100011000111100010101110000001111111011001010001001101101101110100000"
    "100100011000010011110011001000010011111111011111111111011001101010001100001110101001001001110101110101110011111000111001010000000100000111001101010001"
    "100100101101100011010110110100010011100010000100001011000100011111000011111101100001110001110001010110011101111010001100101100010011000011111110110011"
    "011110111001110101110100110100010110010011011100001001100010101011100001001010000001000010110101010001101111111101010010000110100110110100000111111101"
    "001100101010101111110111000111010000111101100101101000101011111000110001110011100110010000110101010001101100111001010111001111100001111010111001110011"
    "110110001011101010100101000010111101000000110100001110011001111111000011111011000101011110001100110010100100001000000101100101111001111001111111001010"
    "001001011010000100110110011101001101110010010100011111001111000010111011000111000100011011110001010100011101110001001101010110010000010110110011101110"
    "011100010001011110111010111101100101000110000010000010111111100000001100101101100010000011011001000110111000110011111101011001110010101001011101001100"
    "101000100100101010100110111011000011110011101101000100011001110100000001010011011001101001110010001000100011010100111101011100101101001011110010110000"
    "111000111101011110100100111010101100101001011110010100100011110101010100111010111000110110111111011000100010010101011101001000110101100101001110000011\0"
    ; 
    
    
        /* 2992 bits */
    char* mod_string = 
    "100111111101101010000011110100001100011011001111111010100110110110110010010100101100011100110100100011001011101000110010100110101100110111101110001111"
    "100011100011100010000000100100110110000000100011110111010010100101111111010101101100100101101110010000111110100110111101000111001000001110110100010110"
    "001100001010111010010000010110111001001001001001001101001001000011100010011000101111010010000001010011110001100011100010101111001010101111111100100110"
    "000110100011010110101000001011010000101100011000001001000011100010110010010001100111110111010010100000000010000000101100010100111110110010110001100010"
    "100110100101000010101110111001001110000000100011010110000000000110110000111000101011101000111001100000011010000101100100100110011101100010001001011010"
    "011000000010111010110100110111111111110000110100100000111010111100000111110000001000010111000011000111111110110110111100010111110000010000100010100000"
    "010000110110101110011010110110011011110111111111000001110000111101111001101001000010000111100011011011101001100001110000110101111110010010100111001010"
    "001011101011010011111110110010111100101110010110101011001100111100110100001011000010001010010001001110001101110000111111001000000011011001111111101101"
    "010101000000001110000001011100010101000110111100000010100001111111101000101110000010011100000000001001101101100001011000001010001100001101000110011010"
    "110011101010100001101101001110000111101011111011110011101101101010110100100100110110101001001100010110110101001000000001000001101011010111110001100101"
    "000100101101011010000010110010000111000111010011000111010101000100100001011100001100011000111100010101110000001111111011001010001001101101101110100000"
    "100100011000010011110011001000010011111111011111111111011001101010001100001110101001001001110101110101110011111000111001010000000100000111001101010001"
    "100100101101100011010110110100010011100010000100001011000100011111000011111101100001110001110001010110011101111010001100101100010011000011111110110011"
    "011110111001110101110100110100010110010011011100001001100010101011100001001010000001000010110101010001101111111101010010000110100110110100000111111101"
    "001100101010101111110111000111010000111101100101101000101011111000110001110011100110010000110101010001101100111001010111001111100001111010111001110011"
    "110110001011101010100101000010111101000000110100001110011001111111001011111011000101011110001100110010100100001000000101100101111001111001111111001010"
    "001001011010000100110110011101001101110010010110011111001111000010111011000111000100011011110001010100011101110001001101010110010000110110110011101110"
    "011100010001011110111010111101100101000110000010000010111111100000001100101101100010000011011001000110111000110011111111011001110010101001011101001100"
    "101000100100101010100100111011000011110011101101000100011001110100000001010011011001101001110010001000100011010100111101011100101101001011110010110000"
    "1110001111010111101001001110101011001010010111100101001000111101010101001110101110001101101000110010001000100101010111010000000101010001000010\0"
    ;
    
    
    uint32_t len = strlen(bit_number);                      
    bigint_create_from_string(&N4, 8000, bit_number, len);
    bigint_create(&N3, 8000, 14);
    bigint_create_from_string(&mod2, 8000, mod_string, len - 8);
    bigint_create(&R2, 8000, 1);
    
    clock_t t;
    
    double times[50];
    struct bigint results[50];
    
    for(uint32_t i = 0; i < 50; ++i){
        bigint_create(&(results[i]), 8000, 0);
    }
    
    for(uint32_t i = 0; i < 50; ++i){
        t = clock();
        bigint_mod_pow(&N3, &N4, &mod2, &(results[i]));   
        
        t = clock() - t;
        times[i] = ((double)t)/CLOCKS_PER_SEC; //in seconds  
        
    }

    double total_time = 0, avg_time = 0;
    
    output_yel(); printf("\n^^^ Expected: up to 2992-bit number  ^^^\n\n"); output_rst();
    
    bigint_print_info(&R2);
    bigint_print_bits(&R2);
    
    printf("[END] --> Times taken:\n");
    
    for(uint32_t i = 0; i < 50; ++i){
        printf("%f\n", times[i]);  
        total_time += times[i];  
    }
    
    avg_time = total_time / (double)50;
    
    printf("TOTAL TIME  : %f\n", total_time);
    printf("AVERAGE TIME: %F\n", avg_time);
    
    free(N1.bits); 
    free(N2.bits); 
    free(mod.bits);
    free(R.bits);        
    
    return 0;

}           
